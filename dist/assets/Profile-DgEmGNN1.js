import{S as e,a as t,b as n,c as r,d as i,f as a,g as o,h as s,i as c,l,n as u,r as d,s as f,u as p,x as m,y as h}from"./index-m46nr8T0.js";var g={class:`profile-container`},_={class:`profile-content`},v={class:`profile-card`},y={class:`avatar-section`},b={class:`avatar-container`},x=[`src`],S={class:`avatar-upload-btn`},C={class:`user-info`},w={class:`username`},T={class:`email`},E={class:`join-date`},D={class:`profile-card`},O={class:`form-group`},k=[`disabled`],A={class:`profile-card`},j={class:`form-group`},M={class:`form-group`},N={class:`form-group`},P=[`disabled`],F={class:`profile-card`},I=[`disabled`],L={key:0,class:`upload-progress`},R={class:`progress-bar`},z=c({__name:`Profile`,setup(c){let z=t(),B=n({username:``,email:``,avatar:``,joinDate:``}),V=n({nickname:``}),H=n({oldPassword:``,newPassword:``,confirmPassword:``}),U=n(!1),W=n(!1),G=n(!1),K=n(!1),q=n(0),J=l(()=>H.value.newPassword===H.value.confirmPassword&&H.value.newPassword.length>=6);s(()=>{Y()});let Y=async()=>{try{let e=JSON.parse(localStorage.getItem(`user`)||`{}`);B.value={username:e.username||``,email:e.email||``,avatar:e.avatar||``,joinDate:e.joinDate||``},V.value.nickname=B.value.username}catch(e){console.error(`加载用户信息失败:`,e)}},X=async()=>{if(!V.value.nickname.trim()){alert(`昵称不能为空`);return}U.value=!0;try{await u(`/users/update/nickname`,{nickname:V.value.nickname.trim()});let e=JSON.parse(localStorage.getItem(`user`)||`{}`);e.username=V.value.nickname.trim(),localStorage.setItem(`user`,JSON.stringify(e)),B.value.username=V.value.nickname.trim(),alert(`昵称修改成功！`)}catch(e){console.error(`修改昵称失败:`,e),alert(`修改昵称失败: `+(e.response?.data?.message||`请稍后重试`))}finally{U.value=!1}},Z=async()=>{if(!J.value){alert(`密码不匹配或长度不够`);return}W.value=!0;try{await u(`/users/update/password`,{oldPassword:H.value.oldPassword,newPassword:H.value.newPassword}),H.value={oldPassword:``,newPassword:``,confirmPassword:``},alert(`密码修改成功！请重新登录`),$()}catch(e){console.error(`修改密码失败:`,e),alert(`修改密码失败: `+(e.response?.data?.message||`请检查原密码是否正确`))}finally{W.value=!1}},Q=async e=>{let t=e.target.files[0];if(t){if(![`image/jpeg`,`image/png`,`image/gif`].includes(t.type)){alert(`请上传JPG、PNG或GIF格式的图片`);return}if(t.size>5*1024*1024){alert(`图片大小不能超过5MB`);return}K.value=!0,q.value=0;try{let e=await d(`/users/upload/avatar`,t,e=>{q.value=e}),n=JSON.parse(localStorage.getItem(`user`)||`{}`);n.avatar=e.avatarUrl,localStorage.setItem(`user`,JSON.stringify(n)),B.value.avatar=e.avatarUrl,alert(`头像上传成功！`)}catch(e){console.error(`上传头像失败:`,e),alert(`上传头像失败: `+(e.response?.data?.message||`请稍后重试`))}finally{K.value=!1,q.value=0,e.target.value=``}}},$=async()=>{if(confirm(`确定要退出登录吗？`)){G.value=!0;try{localStorage.removeItem(`token`),localStorage.removeItem(`user`),z.push(`/login`)}catch(e){console.error(`退出登录失败:`,e),localStorage.removeItem(`token`),localStorage.removeItem(`user`),z.push(`/login`)}finally{G.value=!1}}};return(t,n)=>(o(),a(`div`,g,[n[11]||=p(`div`,{class:`profile-header`},[p(`h1`,null,`个人中心`)],-1),p(`div`,_,[p(`div`,v,[p(`div`,y,[p(`div`,b,[p(`img`,{src:B.value.avatar||`/default-avatar.png`,alt:`用户头像`,class:`avatar`},null,8,x),p(`label`,S,[p(`input`,{type:`file`,accept:`image/*`,onChange:Q,style:{display:`none`}},null,32),n[4]||=p(`span`,null,`更换头像`,-1)])]),p(`div`,C,[p(`h2`,w,e(B.value.username||`用户`),1),p(`p`,T,e(B.value.email||`未设置邮箱`),1),p(`p`,E,`注册时间: `+e(B.value.joinDate||`未知`),1)])])]),p(`div`,D,[n[6]||=p(`h3`,null,`基本信息`,-1),p(`form`,{onSubmit:r(X,[`prevent`]),class:`info-form`},[p(`div`,O,[n[5]||=p(`label`,{for:`nickname`},`昵称`,-1),h(p(`input`,{id:`nickname`,type:`text`,"onUpdate:modelValue":n[0]||=e=>V.value.nickname=e,placeholder:`请输入昵称`,required:``,minlength:`2`,maxlength:`20`},null,512),[[f,V.value.nickname]])]),p(`button`,{type:`submit`,class:`btn-primary`,disabled:U.value},e(U.value?`保存中...`:`保存昵称`),9,k)],32)]),p(`div`,A,[n[10]||=p(`h3`,null,`修改密码`,-1),p(`form`,{onSubmit:r(Z,[`prevent`]),class:`password-form`},[p(`div`,j,[n[7]||=p(`label`,{for:`oldPassword`},`原密码`,-1),h(p(`input`,{id:`oldPassword`,type:`password`,"onUpdate:modelValue":n[1]||=e=>H.value.oldPassword=e,placeholder:`请输入原密码`,required:``},null,512),[[f,H.value.oldPassword]])]),p(`div`,M,[n[8]||=p(`label`,{for:`newPassword`},`新密码`,-1),h(p(`input`,{id:`newPassword`,type:`password`,"onUpdate:modelValue":n[2]||=e=>H.value.newPassword=e,placeholder:`请输入新密码（至少6位）`,required:``,minlength:`6`},null,512),[[f,H.value.newPassword]])]),p(`div`,N,[n[9]||=p(`label`,{for:`confirmPassword`},`确认新密码`,-1),h(p(`input`,{id:`confirmPassword`,type:`password`,"onUpdate:modelValue":n[3]||=e=>H.value.confirmPassword=e,placeholder:`请再次输入新密码`,required:``},null,512),[[f,H.value.confirmPassword]])]),p(`button`,{type:`submit`,class:`btn-primary`,disabled:W.value||!J.value},e(W.value?`修改中...`:`修改密码`),9,P)],32)]),p(`div`,F,[p(`button`,{class:`btn-danger logout-btn`,onClick:$,disabled:G.value},e(G.value?`退出中...`:`退出登录`),9,I)])]),K.value?(o(),a(`div`,L,[p(`div`,R,[p(`div`,{class:`progress-fill`,style:m({width:q.value+`%`})},null,4)]),p(`span`,null,e(q.value)+`%`,1)])):i(``,!0)]))}},[[`__scopeId`,`data-v-6324095f`]]);export{z as default};